function atom(o){return{type:"Atom",value:o,toString:function(){return this.value}}}function bin(o){return{type:"Binary",value:o,toString:function(){return"<<'"+this.value+"'>>"}}}function tuple(){return{type:"Tuple",value:arguments,toString:function(){var s="";for(var i=0;i<this.value.length;i++){if(s!=="")s+=",";s+=this.value[i]}return"{"+s+"}"}}}function dec(S){return decode(ltoa(new Uint8Array(S)))}function enc(s){var ori=encode(s),buf=new Uint8Array(new ArrayBuffer(ori.length));for(var i=0;i<buf.length;i++){buf[i]=ori.charCodeAt(i)}return new Blob([buf.buffer])}BERT=itoa(131);SATOM=itoa(115);ATOM=itoa(100);BINARY=itoa(109);SINT=itoa(97);INT=itoa(98);FLOAT=itoa(99);STR=itoa(107);LIST=itoa(108);SBIG=itoa(110);LBIG=itoa(111);TUPLE=itoa(104);LTUPLE=itoa(105);NIL=itoa(106);ZERO=itoa(0);function itoa(x){return String.fromCharCode(x)}function ltoa(a){for(var i=0,s="";i<a.length;i++)s+=itoa(a[i]);return s}function itol(Int,Length){var isNegative,OriginalInt,i,Rem,s="";isNegative=Int<0;if(isNegative){Int=Int*(0-1)}OriginalInt=Int;for(i=0;i<Length;i++){Rem=Int%256;if(isNegative){Rem=255-Rem}s=String.fromCharCode(Rem)+s;Int=Math.floor(Int/256)}if(Int>0){throw"BERT: Range: "+OriginalInt}return s}function ltoi(S,Length){var isNegative,i,n,Num=0;isNegative=S.charCodeAt(0)>128;for(i=0;i<Length;i++){n=S.charCodeAt(i);if(isNegative){n=255-n}if(Num===0){Num=n}else{Num=Num*256+n}}if(isNegative){Num=Num*(0-1)}return Num}function ltobi(S,Count){var isNegative,i,n,Num=0;isNegative=S.charCodeAt(0)===1;S=S.substring(1);for(i=Count-1;i>=0;i--){n=S.charCodeAt(i);if(Num===0){Num=n}else{Num=Num*256+n}}if(isNegative){return Num*-1}return Num}function encode(o){return BERT+en_inner(o)}function en_inner(Obj){if(Obj===undefined)return NIL;var func="en_"+typeof Obj;return eval(func)(Obj)}function en_string(Obj){return STR+itol(Obj.length,2)+Obj}function en_boolean(Obj){if(Obj)return en_inner(atom("true"));else return en_inner(atom("false"))}function en_number(Obj){var isi=Obj%1===0;if(!isi){return en_float(Obj)}if(isi&&Obj>=0&&Obj<256){return SINT+itol(Obj,1)}return INT+itol(Obj,4)}function en_float(Obj){var s=Obj.toExponential();while(s.length<31){s+=ZERO}return FLOAT+s}function en_object(Obj){if(Obj.type==="Atom")return en_atom(Obj);if(Obj.type==="Binary")return en_bin(Obj);if(Obj.type==="Tuple")return en_tuple(Obj);if(Obj.constructor.toString().indexOf("Array")!==-1)return en_array(Obj);return en_associative_array(Obj)}function en_atom(Obj){return ATOM+itol(Obj.value.length,2)+Obj.value}function en_bin(Obj){return BINARY+itol(Obj.value.length,4)+Obj.value}function en_tuple(Obj){var i,s="";if(Obj.value.length<256){s+=TUPLE+itol(Obj.value.length,1)}else{s+=LTUPLE+itol(Obj.value.length,4)}for(i=0;i<Obj.value.length;i++){s+=en_inner(Obj.value[i])}return s}function en_array(Obj){var i,s=LIST+itol(Obj.length,4);for(i=0;i<Obj.length;i++){s+=en_inner(Obj[i])}s+=NIL;return s}function en_associative_array(Obj){var key,Arr=[];for(key in Obj){if(Obj.hasOwnProperty(key)){Arr.push(tuple(atom(key),Obj[key]))}}return en_array(Arr)}function decode(S){if(S[0]!==BERT){throw"Not a valid BERT."}var Obj=de_inner(S.substring(1));if(Obj.rest!==""){throw"Invalid BERT."}return Obj.value}function de_inner(S){var Type=S[0];S=S.substring(1);switch(Type){case SATOM:de_atom(S,1);case ATOM:return de_atom(S,2);case BINARY:return de_bin(S);case SINT:return de_small_integer(S);case INT:return de_integer(S);case FLOAT:return de_float(S);case SBIG:return de_big(S,1);case LBIG:return de_big(S,4);case STR:return de_string(S);case LIST:return de_list(S);case TUPLE:return de_tuple(S,1);case NIL:return de_nil(S);default:throw"BERT: "+S.charCodeAt(0)}}function de_atom(S,Count){var Size,Value;Size=ltoi(S,Count);S=S.substring(Count);Value=S.substring(0,Size);if(Value==="true"){Value=true}else if(Value==="false"){Value=false}return{value:atom(Value),rest:S.substring(Size)}}function de_bin(S){var Size=ltoi(S,4);S=S.substring(4);return{value:bin(S.substring(0,Size)),rest:S.substring(Size)}}function de_big(S,Count){var Size,Value;Size=ltoi(S,Count);S=S.substring(Count);Value=ltobi(S,Size);return{value:Value,rest:S.substring(Size+1)}}function de_integer(S){var Value=ltoi(S,4);S=S.substring(4);return{value:Value,rest:S}}function de_small_integer(S){var Value=S.charCodeAt(0);S=S.substring(1);return{value:Value,rest:S}}function de_float(S){var Size=31;return{value:parseFloat(S.substring(0,Size)),rest:S.substring(Size)}}function de_string(S){var Size=ltoi(S,2);S=S.substring(2);return{value:S.substring(0,Size),rest:S.substring(Size)}}function de_list(S){var Size,i,El,LastChar,Arr=[];Size=ltoi(S,4);S=S.substring(4);for(i=0;i<Size;i++){El=de_inner(S);Arr.push(El.value);S=El.rest}LastChar=S[0];if(LastChar!==NIL){throw"BERT: Wrong NIL."}S=S.substring(1);return{value:Arr,rest:S}}function de_tuple(S,Count){var Size,i,El,Arr=[];Size=ltoi(S,Count);S=S.substring(Count);for(i=0;i<Size;i++){El=de_inner(S);Arr.push(El.value);S=El.rest}return{value:tuple(Arr),rest:S}}function de_nil(S){return{value:[],rest:S}}var $bert={};$bert.on=function onbert(evt,callback){if(Blob.prototype.isPrototypeOf(evt.data)&&evt.data.length>0){var reader=new FileReader;reader.addEventListener("loadend",function(){try{var erlang=dec(reader.result);if(typeof callback=="function")callback(erlang)}catch(e){return{status:"error",desc:e}}});reader.readAsArrayBuffer(evt.data);return{status:"ok"}}else{return{status:"error",desc:"not Bert"}}};var $binary={};$binary.on=function onbinary(evt,callback){var HEAD_SIZE=36;if(Blob.prototype.isPrototypeOf(evt.data)&&evt.data.length>=HEAD_SIZE){var reader=new FileReader;reader.addEventListener("loadend",function(){var header_view=new DataView(reader.result);var head_char=header_view.getUint8(0);if(head_char!==132||reader.result.byteLength!=HEAD_SIZE)return{status:"error",desc:"not #binary{}"};var id=header_view.getUint32(1);var type=header_view.getUint8(5);var app=header_view.getUint8(6);var version=header_view.getUint8(7);var from=header_view.getUint32(8);var to=header_view.getUint32(12);var user1=header_view.getFloat64(16);var user2=header_view.getFloat64(24);var data_offset=HEAD_SIZE+header_view.getUint32(32);var meta_reader=new FileReader;meta_reader.addEventListener("loadend",function(){if(typeof callback=="function")callback(id,type,app,version,from,to,user1,user2,meta_reader.result,evt.data.slice(data_offset));else{console.log("Raw Binary With Header Received: Header ["+utf8_fromByteArray(reader.result)+"] Meta ["+utf8_fromByteArray(meta_reader.result)+"] Data lehgth: "+(evt.data.size-data_offset));console.log("Header fields { id: "+id+", type: "+type+", app: "+app+", version: "+version+", from: "+from+", to: "+to+", user1: "+user1+", user2: "+user2+" }")}});meta_reader.readAsArrayBuffer(evt.data.slice(HEAD_SIZE,data_offset));if(typeof callback=="function")callback(erlang)});reader.readAsArrayBuffer(evt.data.slice(0,HEAD_SIZE));return{status:"ok"}}else{return{status:"error",desc:"not #binary{}"}}};var $client={};$client.on=function onclient(evt,callback){try{msg=JSON.parse(evt.data);if(typeof callback=="function"&&msg.data)callback(msg.data);console.log(msg.eval);if(msg.eval)try{eval(msg.eval)}catch(e){return{status:"error",desc:e}}}catch(ex){return{status:"error",desc:ex}}return{status:"ok"}};function querySourceRaw(Id){var val,el=document.getElementById(Id);if(!el)return"";switch(el.getAttribute("type")){case"fieldset":val=document.querySelector("#"+Id+" :checked");val=val?val.value:"";break;case"radio":case"checkbox":val=el.checked?el.value:"";break;case"date":val=getErlDate(el);break;default:var edit=el.getAttribute("contenteditable");if(edit&&edit==="true")val=el.innerHTML;else val=el.value}return val}function querySource(Id){var qs=querySourceRaw(Id);if(""==qs)return bin("");else return utf8_toByteArray(qs)}function getErlDate(el){var val=/^(\d{4})-(\d{1,2})-(\d{1,2})$/.exec(el.value);if(val!=null){var uDate=new Date(parseInt(val[1]),parseInt(val[2])-1,parseInt(val[3]));if(uDate.getMonth()+1==parseInt(val[2])&&uDate.getDate()==parseInt(val[3])&&uDate.getFullYear()==parseInt(val[1])){val[2]=uDate.getMonth()<9?"0"+(uDate.getMonth()+1):uDate.getMonth()+1;val[3]=uDate.getDate()<10?"0"+uDate.getDate():uDate.getDate();val="{"+uDate.getFullYear()+","+val[2]+","+val[3]+"}"}else val=""}else val="";return val}function bullet(url){var CONNECTING=0;var OPEN=1;var CLOSING=2;var CLOSED=3;var transports={websocket:function(){var transport=null;if(window.WebSocket){transport=window.WebSocket}if(transport){return{heart:true,transport:transport}}return null},xhrPolling:function(){var timeout;var xhr;nextPoll();var fake={readyState:CONNECTING,receive:function(data){if(fake.readyState==CONNECTING){fake.readyState=OPEN;fake.onopen(fake)}if(data.length!=0){fake.onmessage({data:data})}if(fake.readyState==OPEN){nextPoll()}},send:function(data){if(this.readyState!=CONNECTING&&this.readyState!=OPEN)return false;var fakeurl=url.replace("ws:","http:").replace("wss:","https:");var request=new XMLHttpRequest;request.open("POST",fakeurl,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");request.setRequestHeader("X-Socket-Transport","xhrPolling");request.onload=function(){fake.receive(request.response)};request.send(data);return true},close:function(){this.readyState=CLOSED;xhr.abort();clearTimeout(timeout);fake.onclose()},onopen:function(){},onmessage:function(){},onerror:function(){},onclose:function(){}};function poll(pooling){var fakeurl=url.replace("ws:","http:").replace("wss:","https:");var request=new XMLHttpRequest;request.open("GET",fakeurl,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");request.setRequestHeader("X-Socket-Transport","xhrPolling");request.onload=function(){fake.receive(request.response)};request.onerror=function(){fake.onerror()};request.send({})}function nextPoll(){timeout=setTimeout(function(){poll()},1e3)}return{heart:false,transport:function(){return fake;fake.nextPoll()}}}};var tn=0;function next(){var c=0;for(var f in transports){if(tn==c){var t=transports[f]();if(t){var ret=new t.transport(url);ret.heart=t.heart;return ret}tn++}c++}return false}var stream=new function(){var isClosed=true;var readyState=CLOSED;var heartbeat;var delay=80;var delayDefault=80;var delayMax=1e4;var transport;function init(){isClosed=false;readyState=CONNECTING;transport=next();if(!transport){delay=delayDefault;tn=0;stream.ondisconnect();setTimeout(function(){init()},delayMax);return false}transport.onopen=function(){delay=delayDefault;if(transport.heart){heartbeat=setInterval(function(){stream.onheartbeat()},4e3)}if(readyState!=OPEN){readyState=OPEN;stream.onopen()}};transport.onclose=function(){if(isClosed){return}transport=null;clearInterval(heartbeat);if(readyState==CLOSING){readyState=CLOSED;stream.onclose()}else{if(readyState==CONNECTING)tn++;delay*=2;if(delay>delayMax){delay=delayMax}isClosed=true;setTimeout(function(){init()},delay)}};transport.onerror=transport.onclose;transport.onmessage=function(e){stream.onmessage(e)}}init();this.onopen=function(){};this.oninit=function(){};this.onmessage=function(){};this.ondisconnect=function(){initialized=false};this.onclose=function(){};this.onheartbeat=function(){return this.send("PING")};this.setURL=function(newURL){url=newURL};this.send=function(data){if(transport)return transport.send(data);else return false};this.close=function(){readyState=CLOSING;if(transport)transport.close()}};return stream}function utf8_toByteArray(str){var byteArray=[];if(str!==undefined&&str!==null)for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function utf8_fromByteArray(byteArray,separator){if(typeof byteArray=="undefined"||byteArray.byteLength==0){return""}separator=typeof separator!=="undefined"?separator:",";var dataView=new DataView(byteArray);var s=dataView.getUint8(0).toString();for(var i=1;i<byteArray.byteLength;i++)s=s+separator+dataView.getUint8(i).toString();return s}function utf8_decode(utftext){var string="";var i=c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string}function template(html,data){var re=/{([^}]+)?}/g,code="var r=[];",cursor=0;var add=function(line,js){js?code+="r.push("+line+");":code+=line!=""?'r.push("'+line.replace(/"/g,'\\"')+'");':"";return add};while(match=re.exec(html)){add(html.slice(cursor,match.index))(match[1],true);cursor=match.index+match[0].length}add(html.substr(cursor,html.length-cursor));code+='return r.join("");';return new Function(code.replace(/[\r\t\n]/g,"")).apply(data)}function xml(html){return(new DOMParser).parseFromString(html,"application/xhtml+xml").firstChild}function dom(html){var dom=(new DOMParser).parseFromString(html,"text/html").firstChild.getElementsByTagName("body")[0].firstChild;return dom}var active=false,protocol=window.location.protocol=="https:"?"wss://":"ws://",querystring=window.location.pathname+window.location.search,host=null==transition.host?window.location.hostname:transition.host,port=null==transition.port?window.location.port:transition.port,protos=[$client,$binary,$bert];function N2O_start(){ws=new bullet(protocol+host+":"+port+"/ws"+querystring);ws.onmessage=function(evt){for(var i=0;i<protos.length;i++){p=protos[i];if(p.on(evt,p.do).status=="ok")return}};ws.onopen=function(){if(!active){console.log("Connect");ws.send(["N2O",transition.pid]);active=true}};ws.ondisconnect=function(){active=false;console.log("Disconnect")}}function qi(name){return document.getElementById(name)}function qs(name){return document.querySelector(name)}function qn(name){return document.createElement(name)}function validateSources(list){return list.reduce(function(acc,x){var event=new CustomEvent("validation");event.initCustomEvent("validation",true,true,querySourceRaw(x));var el=qi(x),listener=el&&el.validation,res=!listener||listener&&el.dispatchEvent(event);console.log(res);if(el)el.style.background=res?"":"pink";return res&&acc},true)}function validateLength(e,minlength,maxlength){var field=e.detail;return field.length>=minlength&&field.length<=maxlength}function validateMin(e,min){var field=e.detail;var re=/^\d{1,}$/;console.log(re.test(field));return!re.test(field)?false:parseFloat(field)>min}(function(){function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();